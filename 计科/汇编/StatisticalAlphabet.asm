;本代码用于计算文件里各个英文字母的个数，需要在汇编的bin文件夹里提前创建好TEST.txt且输入一段英文字符串
;不建议输入别的字符
DATAS SEGMENT
 FNAME DB 'TEST.txt',0
 ERROR1 DB 'File not found',07H,0
 ERROR2 DB 'Reading error',07H,0
 STRING1 DB 'Number of $';各类字符提示信息
 STRING2 DB ': $'
 ARRAY DB 26 DUP(0);字母个数数组
 OTHERS DB 0
 BUFFER DB ?;数据缓冲区
 EOF DB 032H
DATAS ENDS

CODES SEGMENT
 ASSUME CS:CODES,DS:DATAS
START:
 MOV AX,DATAS
 MOV DS,AX
 MOV DX,OFFSET FNAME
 MOV AX,3D00H;读打开指定文件
 INT 21H
 JNC OPEN;打开成功
 MOV SI,OFFSET ERROR1 
 CALL DMESS
 JMP OVER

;打开成功,发生跳转
OPEN:
 MOV BX,AX;保存文件句柄
GO: CALL READ_CHAR;从文件中读一个字符
 JC READ_ERROR;读取错误
 CMP AL,EOF;是否读到文件结束符
 JZ TYPE_OK
 CALL PUNCH
 JMP GO
 
 READ_ERROR:
 MOV SI,OFFSET ERROR2
 CALL DMESS
 
TYPE_OK:
 MOV AH,3EH
 INT 21H;关闭文件
 MOV DL,0AH
 MOV AH,02H
 INT 21H
 CALL SHOW
 
OVER:
 MOV AH,07H
 INT 21H
 MOV AH,4CH
 INT 21H;带返回码结束
 
READ_CHAR PROC
 MOV CX,1;要读取的字节数
 MOV DX,OFFSET BUFFER;置缓冲区地址
 MOV AH,3FH;读文件
 INT 21H
 JC R1;读出错
 CMP AX,CX;判断文件是否结束
 MOV AL,EOF
 JB R2
 MOV AL,BUFFER
R2: CLC
R1: RET
READ_CHAR ENDP
DMESS PROC
DMESS1:
 MOV DL,[SI]
 INC SI
 OR DL,DL
 JZ DMESS2
 MOV AH,02H
 INT 21H;显示一个字符
 JMP DMESS1
DMESS2:RET
DMESS ENDP

PUNCH PROC
 PUSH DX
 MOV DL,AL
 MOV AH,02H;显示一个字符
 INT 21H
 POP DX
 MOV CL,41H;(A)
 LEA DI,ARRAY
 MOV CH,AL
 CMP CH,CL
 JB OTHER;若IF<41H(A),OTHER++
 CMP CH,5AH
 JA HIGHER2;若IF>5AH(Z),继续比较
H1: CMP CH,CL
 JE CHAR;对应字母个数++
 JA LOOP1
LOOP1:
 INC CL
 ADD DI,1
 JMP H1
 
HIGHER2:
 MOV CL,61H;(a)
 LEA DI,ARRAY
 MOV CH,AL
 CMP CH,CL
 JB OTHER;若IF<61H(a),OTHER++
 CMP CH,7AH
 JA OTHER;若IF>7AH(z),OTHER++
H2: CMP CH,CL
 JE CHAR;对应字母个数++
 JA LOOP2
 
LOOP2:
 INC CL
 ADD DI,1
 JMP H2
 
CHAR:
 XOR CH,CH
 MOV CH,[DI]
 
 INC CH
 MOV [DI],CH
OTHER:
 INC OTHERS
;比较结束
 RET
PUNCH ENDP
SHOW PROC
 LEA SI,ARRAY
 MOV DI,41H
LOOP3:
 LEA DX,STRING1
 MOV AH,09H
 INT 21H
 MOV DX,DI
 MOV AH,02H
 INT 21H
 LEA DX,STRING2
 MOV AH,09H
 INT 21H
 XOR AX,AX
 MOV AL,[SI];将统计的数字送给AX
 ADD SI,1
 CALL DISPLAY
 CALL ENDLINE
 INC DI
 CMP DI,5BH;DI是否为字母
 JB LOOP3
 MOV AH,4CH;带返回码结束
 INT 21H
 RET
SHOW ENDP

ENDLINE PROC NEAR
 MOV DL,20H
 MOV AH,02H
 INT 21H ;输出加空格换行
 MOV DL,20H
 MOV AH,02H
 INT 21H
 MOV DL,20H
 MOV AH,02H
 
 INT 21H
 MOV DL,20H
 MOV AH,02H
 INT 21H
 RET
ENDLINE ENDP
DISPLAY PROC NEAR
 MOV BL,10
 DIV BL;AX/BL,AL=商,AH=余数
 PUSH AX
 MOV DL,AL
 ADD DL,30H
 MOV AH,02H;输出十位数
 INT 21H
 POP AX
 MOV DL,AH
 ADD DL,30H
 MOV AH,02H
 INT 21H;输出个位数
 MOV DL,20H
 MOV AH,02H
 INT 21H
 RET
DISPLAY ENDP
CODES ENDS
 END START
